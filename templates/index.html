{% extends "base.html" %}

{% block title %}Home - Flask Tailwind Project{% endblock %}

{% block content %}
<div class="p-4">
  <h1 class="text-2xl font-bold">Welcome to the Flask Tailwind Project</h1>
  <p class="mt-2">
    This page supports both dark and light modes using Tailwind CSS.
  </p>

  <!-- Add Student Submission Button -->
  <button class="bg-blue-500 text-white py-2 px-4 rounded-lg mt-4" id="showStudentPopupBtn">
    Add Student Submission
  </button>

  <!-- Overlay for Student Popup -->
  <div class="fixed inset-0 bg-black bg-opacity-50 hidden" id="studentOverlay"></div>

  <!-- Student Submission Popup -->
  <div class="fixed inset-0 flex items-center justify-center hidden" id="studentPopup">
    <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm w-full">
      <h2 class="text-xl font-semibold mb-4 text-black">Add Student Submission</h2>
      <form id="studentForm" onsubmit="event.preventDefault(); submitForm();">
        <div class="mb-4">
          <label for="student_name" class="block text-sm font-medium text-gray-700 text-black">
            Student Name
          </label>
          <input
            type="text"
            id="student_name"
            name="student_name"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-black"
            required
          />
        </div>
        <div class="mb-4">
          <label for="student_solution" class="block text-sm font-medium text-gray-700 text-black">
            Student Solution
          </label>
          <input
            type="text"
            id="student_solution"
            name="student_solution"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg text-black"
            required
          />
        </div>
        <button type="submit" class="bg-green-500 text-white py-2 px-4 rounded-lg">
          Submit
        </button>
      </form>
      <button class="bg-red-500 text-white py-2 px-4 rounded-lg mt-4" id="closeStudentPopupBtn">
        Close
      </button>
    </div>
  </div>

  <!-- Add Assignment Button -->
  <button class="bg-blue-500 text-white py-2 px-4 rounded-lg mt-4" id="showAssignmentPopupBtn">
    Add Assignment
  </button>

  <!-- Overlay for Assignment Popup -->
  <div class="fixed inset-0 bg-black bg-opacity-50 hidden" id="assignmentOverlay"></div>

  <!-- Assignment Upload Popup -->
  <div class="fixed inset-0 flex items-center justify-center hidden" id="assignmentPopup">
    <div class="bg-white p-6 rounded-lg shadow-lg max-w-sm w-full">
      <h2 class="text-black font-semibold mb-4 text-black">Upload Description</h2>
      <form action="/upload_description" method="POST" enctype="multipart/form-data">
        <div class="mb-4">
          <label for="assignment_file" class="block text-sm font-medium text-gray-700">
            Upload description
          </label>
          <input
            type="file"
            id="assignment_file"
            name="assignment_file"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg"
            accept=".pdf"
            required
          />
        </div>
        <button type="submit" class="bg-green-500 text-white py-2 px-4 rounded-lg">
          Submit
        </button>
      </form>
      <button class="bg-red-500 text-white py-2 px-4 rounded-lg mt-4" id="closeAssignmentPopupBtn">
        Close
      </button>
    </div>
  </div>

  <!-- Button to Grading Dashboard -->
  <a
    href="{{ url_for('grading_dashboard') }}"
    class="inline-block mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
  >
    Go to Grading Dashboard
  </a>

  <!-- Placeholder for Response Messages -->
  <div id="responseMessage" class="hidden mt-4"></div>
</div>


<script>
  // === Handle Student Submission Popup ===
  const showStudentPopupBtn = document.getElementById('showStudentPopupBtn');
  const closeStudentPopupBtn = document.getElementById('closeStudentPopupBtn');
  const studentPopup = document.getElementById('studentPopup');
  const studentOverlay = document.getElementById('studentOverlay');

  // Show Student Popup
  showStudentPopupBtn.addEventListener('click', () => {
    studentPopup.classList.remove('hidden');
    studentOverlay.classList.remove('hidden');
  });

  // Close Student Popup
  closeStudentPopupBtn.addEventListener('click', () => {
    studentPopup.classList.add('hidden');
    studentOverlay.classList.add('hidden');
  });

  studentOverlay.addEventListener('click', () => {
    studentPopup.classList.add('hidden');
    studentOverlay.classList.add('hidden');
  });

  // === Handle Assignment Upload Popup ===
  const showAssignmentPopupBtn = document.getElementById('showAssignmentPopupBtn');
  const closeAssignmentPopupBtn = document.getElementById('closeAssignmentPopupBtn');
  const assignmentPopup = document.getElementById('assignmentPopup');
  const assignmentOverlay = document.getElementById('assignmentOverlay');

  // Show Assignment Popup
  showAssignmentPopupBtn.addEventListener('click', () => {
    assignmentPopup.classList.remove('hidden');
    assignmentOverlay.classList.remove('hidden');
  });

  // Close Assignment Popup
  closeAssignmentPopupBtn.addEventListener('click', () => {
    assignmentPopup.classList.add('hidden');
    assignmentOverlay.classList.add('hidden');
  });

  assignmentOverlay.addEventListener('click', () => {
    assignmentPopup.classList.add('hidden');
    assignmentOverlay.classList.add('hidden');
  });


  function submitForm() {
    const name = document.getElementById('student_name').value;
    const solution = document.getElementById('student_solution').value;

    if (!name || !solution) {
      showMessage('Please fill in all fields.', 'red');
      return;
    }

    fetch('/add_student', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        student_name: name,
        student_solution: solution,
      }),
    })
      .then((response) => {
        if (!response.ok) {
          return response.json().then((data) => {
            throw new Error(data.error || 'Unknown error occurred.');
          });
        }
        return response.json();
      })
      .then((data) => {
        showMessage(data.message || 'Submission successful!', 'green');
        document.getElementById('studentForm').reset();
      })
      .catch((error) => {
        console.error('Error:', error);
        showMessage(`Error: ${error.message}`, 'red');
      });
  }


  function showMessage(message, color) {
    const messageDiv = document.getElementById('responseMessage');
    messageDiv.textContent = message;
    messageDiv.className = `mt-4 text-center text-${color}-500 font-semibold`;
    messageDiv.style.display = 'block';
  }
</script>

{% endblock %}
